#!/bin/bash

# Export Environment Variables From .env File
source .env

# Print Each Command Being Executed
set -ex

function launch_cockroachdb() {
  cockroach start-single-node --listen-addr="$DB_HOST" --http-addr=localhost:9000 --insecure --background
}

function do_migrate() {
  user_params=$*
  COCKROACHDB_URL="cockroachdb://$DB_USER:@$DB_HOST/$DB_NAME?sslmode=disable"

  migrate -verbose -database "${COCKROACHDB_URL}" -path database/migrations "$user_params"

  # Dump Database Schema (*DO NOT EDIT THE database/schema.sql FILE*)
  cockroach dump "$DB_NAME" --insecure &>database/schema.sql
}

function run() {
  # Start Application
  go run application.go
}

function build() {
  mkdir -p bin/
  # Build Application
  go build -o bin/
}

# Allow User To Call Functions
"$@"
